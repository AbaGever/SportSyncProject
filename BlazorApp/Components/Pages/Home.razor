@page "/"
@using Models2;
@using DBL2;
@inject IJSRuntime js
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject ProtectedSessionStorage MySession
@inject Microsoft.AspNetCore.Components.NavigationManager navigationManager





<div>
    <div class="hero_area">
        <!-- header section strats -->
            <div class="container-fluid">
                <nav class="navbar navbar-expand-lg custom_nav-container ">
                    <a class="navbar-brand" href="/">
                        <span>
                            SportSync
                        </span>
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <div class="d-flex ml-auto flex-column flex-lg-row align-items-center">
                            <ul class="navbar-nav">
                                <li class="nav-item active">
                                    <a class="nav-link"  href="/">Home <span class="sr-only">(current)</span></a>
                                </li>
                                
                                    @if (UserS == null && coach == null)
                                    {
                                    <li class="nav-item">
                                        <a class="nav-link" href="/r">Sign Up</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="/login">Log In</a>
                                    </li>
                                    }
                                    else if(coach == null)
                                    {
                                    
                                    <li class="nav-item">
                                        <a class="nav-link" href="/mr">Weekly Reports</a>
                                    </li>
                                    }
                                    @if(coach!=null ||UserS !=null) 
                                    {
                                        <li class="nav-item">
                                        <a class="nav-link" href="/p">Your Profile</a>
                                    </li>
                                    }
                                
                                <li class="nav-item">
                                    <a class="nav-link" href="/searchG">Search Groups</a>
                                </li>
                               
                                
                            </ul>
                            <div class="user_option">
                                <div class="form-inline my-2 my-lg-0 ml-0 ml-lg-4 mb-3 mb-lg-0">
                                    <button class="btn  my-2 my-sm-0 nav_search-btn" type="submit"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        <!-- end header section -->
        <!-- slider section -->
        <section class=" slider_section position-relative" style="background-color:#3a506b">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="container">
                            <div class="col-lg-10 col-md-11 mx-auto">
                                <div class="detail-box" style="color:white">
                                    <div >
                                        <div style="color:wheat">
                                        @if(UserS!=null||coach!=null)
                                        {
                                            if(UserS !=null)
                                            {
                                                <h1>Welcome @(UserS.firstName)</h1>
                                            }
                                            if (coach != null)
                                            {
                                                <h1>Welcome @(coach.firstName)</h1>
                                            }
                                            
                                        }
                                        </div>
                                        <h3>
                                            Fitness
                                        </h3>
                                        <h2>
                                            Training
                                        </h2>
                                        <h1>
                                            SportSync
                                        </h1>
                                        <p>
                                            Your site focuses on developing a scheduling and workout management system designed for both amateur and professional athletes. The system aims to streamline users' workout routines by offering tools that allow the creation of personalized schedules tailored to their fitness level, type of sport, and individual needs.
                                        </p>
                                        @if (UserS == null && coach != null && coach.groupname == "" || coach != null && coach.groupname == null || coach != null && group.coachid != coach.id)
                                        {
                                            <a href="sag" class="button">Sign A Group</a>
                                        }
                                        else if (coach != null && coach.groupname != "" && coach.groupname != null)
                                        {
                                            <a href="ShowG/@(coach.groupname)" class="button">Show Group Info</a>
                                        }
                                        @if(UserS !=null)
                                        {
                                            <a href="t" class="button">Bulid a WorkOut</a>
                                            <a href="ws" class="button">My Calender</a>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- end slider section -->
    </div>


    <!-- Us section -->
    <!-- end us section -->
    <!-- heathy section -->

    <section class="heathy_section layout_padding">
        <div class="container">

            <div class="row">
                <div class="col-md-12 mx-auto">
                    <div class="detail-box">
                        <h2>
                            HEALTHY MIND, HEALTHY BODY
                        </h2>
                        <p>
                            In today's world, fitness and sports have become an integral part of many people's lives, whether they are amateur athletes looking to maintain physical fitness or professional athletes striving for excellence in their sport. With the increasing awareness of the importance of fitness, effectively managing workout routines has become a more challenging task, requiring precise planning, performance tracking, and personalized adaptation for each athlete. There are several key reasons for the need for the site.
                        </p>
                        <div class="btn-box">
                            <a href="https://www.youtube.com/shorts/q_6pq5ntEQ4">
                                READ MORE
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- end heathy section -->
    <!-- trainer section -->

    <section class="trainer_section layout_padding">
        <div class="container">
            <div class="heading_container">
                <h2>
                    Our Gym Trainers
                </h2>
            </div>
            <div class="row">
                <div class="col-lg-4 col-md-6 mx-auto">
                    <div class="box">
                        <div class="name">
                            <h5>
                                Yair BuchBut
                            </h5>
                        </div>
                        <div class="img-box">
                            <img src="homepage/images/Yair.jpg" alt="">
                        </div>

                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mx-auto">
                    <div class="box">
                        <div class="name">
                            <h5>
                               Jonathan Levi
                            </h5>
                        </div>
                        <div class="img-box">
                            <img src="homepage/images/joni.png"alt="">
                        </div>

                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mx-auto">
                    <div class="box">
                        <div class="name">
                            <h5>
                                Marom VineBloom
                            </h5>
                        </div>
                        <div class="img-box">                   
                            <img src=" homepage/images/Marom.jpg"  alt="">
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>


    



</div>


@code {
    Trainer UserS = null; // יצירת משתנה מסוג Trainer לאחסון פרטי מתאמן מהסשן
    Coach coach = null; // יצירת משתנה מסוג Coach לאחסון פרטי מאמן מהסשן
    Group group = new Group(); // יצירת מופע חדש של קבוצה כברירת מחדל
    GroupDB groupDB = new GroupDB(); // יצירת מופע של מחלקת הגישה למסד הנתונים של קבוצות

    protected override async Task OnAfterRenderAsync(bool firstRender) // פונקציה שמופעלת לאחר הרנדר הראשון של הקומפוננטה
    {
        if (firstRender) // בדיקה אם זהו הרנדר הראשון
        {
            try
            {
                await js.InvokeVoidAsync("initializeGradSchool"); // קריאה לפונקציית JavaScript בשם "initializeGradSchool"
            }
            catch (Exception ex)
            {
                Console.WriteLine("JS Init Error: " + ex.Message); // הדפסת שגיאה אם הקריאה ל-JS נכשלה
            }

            var user1 = await MySession.GetAsync<Trainer>("Trainer"); // ניסיון לקבל את המתאמן מהסשן
            if (user1.Success) // בדיקה אם התקבלה תשובה תקינה
            {
                UserS = user1.Value; // שמירת ערך המתאמן במשתנה
                StateHasChanged(); // עדכון מצב הקומפוננטה לרנדר מחודש
            }

            var user2 = await MySession.GetAsync<Coach>("Coach"); // ניסיון לקבל את המאמן מהסשן
            if (user2.Success) // בדיקה אם התקבלה תשובה תקינה
            {
                coach = user2.Value; // שמירת ערך המאמן במשתנה
                if (coach == null) // בדיקה אם לא קיים מאמן
                {
                    group = null; // איפוס הקבוצה
                }
                else
                {
                    group = await groupDB.SelectByPkAsync(coach.groupname); // שליפת הקבוצה לפי שם הקבוצה של המאמן
                }
                StateHasChanged(); // עדכון מצב הקומפוננטה לרנדר מחודש
            }
            else
            {
                if (UserS == null && coach == null && group == null) // בדיקה אם לא קיים מתאמן, מאמן וקבוצה
                {
                    navigationManager.NavigateTo("/"); // ניווט לדף הבית במקרה שאין נתונים
                }
            }
        }
    }
}

